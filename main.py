import tempfile
from fastapi import FastAPI
from modules.stream.youtube import download_audio_from_youtube
from modules.stream.split import split_audio_into_chunks
from modules.transcribe.whisper import transcribe_audio
from modules.summarize.langchain import summarize_langchain

app = FastAPI()

@app.get('/summarize/youtube')
def youtube(uri: str):
    # print('1# Inicio')
    # path_audio = download_audio_from_youtube(uri)
    # print('2# Download track de audio')
    # check_chunk = split_audio_into_chunks(path_audio['path'])
    # print('3# Split track de audio se necessario')
    # transcriptions = []

    # for i, chunk_path in enumerate(check_chunk):
    #     if len(check_chunk) > 1:
    #         try:
    #             with tempfile.NamedTemporaryFile(suffix=".wav", delete=False) as temp_file:
    #                 temp_file_path = temp_file.name
    #                 chunk_path.export(temp_file_path, format="wav")
    #                 transcription = transcribe_audio(temp_file_path)
    #                 transcriptions.append(transcription)
    #         except Exception as e:
    #             print(f"Error processing chunk {i+1}: {e}")
    #     else:
    #         transcription = transcribe_audio(chunk_path)
    #         transcriptions.append(transcription)
    # merged_transcription = '\n'.join([item['text'] for item in transcriptions])
    # print('4# Transcrição realizada com sucesso')
    # print(merged_transcription)
    merged_transcription = 'Fala, galera, tudo bem? Galera, professor Marcelo Guaro aqui e o assunto da aula de hoje é um assunto de extrema importância que é a velocidade média. Gente, essa é a aula número 1 de um total de 3 aulas que eu vou abordar esse assunto com bastante cuidado. Nós faremos uma discussão teórica nessa aula e nos dois próximos vídeos, na aula número 2 e na aula número 3 eu vou fazer com você resolução de exercícios, tá bom? Gente, velocidade média. O que é isso, Guaro? Dê uma olhada aí em uma aplicação desse assunto. Galera, então vou fazer o cálculo da velocidade média é 1,91 km da estrada aqui. Olha lá, galera, 1,90 km Vamos ver quanto deu? Muito bem, no final do vídeo eu vou mostrar para você essa aplicação completa e a resolução daquela velocidade média e agora a gente vai abordar esse assunto com cuidado aqui. Imaginemos uma seguinte situação, pessoal. Imaginemos que você tenha uma trajetória em que você tenha por exemplo, uma bicicleta. A bicicleta está se deslocando em uma trajetória orientada. Gente, essa trajetória pode ser uma pista de atletismo, pode ser uma rua, pode ser uma estrada, pode ser o que for. Você define um zero, você adota uma orientação da trajetória como sendo positiva, por exemplo, para lá e aí a gente começou a estudar o movimento dessa bicicleta. Suponhamos que essa bicicleta saia de um ponto, por exemplo, do ponto 1 e percorra um certo tempo até chegar ao ponto 15. O que nós chamamos de velocidade média? A velocidade média, gente, eu vou explicar aqui para você como se você nunca tivesse visto esse assunto. Para que você possa ter um excelente entendimento, para que você possa ir bem nas suas provas e no que você tiver que encontrar, como concurso público, vestibular, essas coisas, tá bom? Então vamos lá, Boarô, vamos lá. Velocidade média, representamos por um V com um M, velocidade média, nós definimos como sendo ΔS por ΔT. O que é o ΔS? O que é o ΔT? A primeira informação importante é que aqui na física, para nós, Δ significa variação. ΔS, variação do espaço. ΔT, variação do tempo. ΔV, variação da velocidade. ΔA, variação da aceleração. ΔH, variação da altura. Δ para nós é a variação. O que nós pegamos sempre como sendo o final menos o inicial. Então Δ para nós, gente, é final menos inicial. Um exemplo semelhante ao que eu falei para você de uma bicicleta para que você possa entender bem. O espaço final é, por exemplo, onde ele vai estar após um certo tempo. O espaço inicial é onde ele estava quando você começou a estudar o movimento dele, digamos assim. Então é S menos S₀. E o que é o ΔT, professor? O ΔT simplesmente é o T menos o T₀. Aqui já fica uma dica para você. Já fica uma dica para você que esse T₀ é muito comum que ele seja zero. Não é necessariamente zero, mas é muito comum. Gente, nós sabemos que uma pessoa em uma bicicleta, se ela sai de 1.1 vai até 1.15, por exemplo, é natural que ela aumente um pouquinho a velocidade, que ela diminua um pouco a velocidade. Mesmo que ela queira manter a velocidade constante, às vezes é difícil, não é? Então ela não ficou com a velocidade constante nesse percurso. Pense assim. Ele aumentou um pouco, ele diminuiu um pouco, mas ele percorreu esse percurso em um certo intervalo de tempo. Então a gente pode pensar qual foi essa velocidade média que ele teve, professor? Como é que a gente faz? A gente faz utilizando esse conceito, gente, que é o ΔS por ΔT. Olha só. Nesse meu exemplo, suponhamos que ele tenha saído do 1.1 e foi até o 1.15, ok? E ele gastou para isso, por exemplo, 7 segundos. Eu vou pegar 7 segundos porque vai ficar fácil para a gente fazer a conta, tá bom? Então quem que é a velocidade média? A velocidade média vai ser horas. O espaço final está aqui no meu exemplo, 15, menos o espaço inicial. Qual é o espaço inicial, professor? O espaço inicial é 1. Então vai ficar 15 menos 1, ok? Dividido pelo intervalo de tempo. Qual foi o intervalo de tempo que eu disse? 7, né? Por 7 segundos. Você pode pensar assim, gente, 7 menos 0, tá? É muito comum parecer para você nesse formato, ó, 7 menos 0. Bom, quanto é que vai dar isso? 15 menos 1 é 14. 14. Dividido por 7 menos 0, que é 7. É 2. Eu fiz isso aí para que a conta fique facinha nesse meu primeiro exemplo, tá bom? 7 é metade de 14, né? Então aqui dá 2. 2 o quê, professor? Metros por segundo. Aqui entra uma outra informação bastante importante que você precisa entender. As unidades, pessoal, das grandezas físicas, a gente diz, as unidades elas são de importância, você precisa entender. Tá bom? Como eu falei que era em metros e o tempo é dado em segundos, então aqui é o metro por segundo. No entanto, você que já estudou isso aqui um pouquinho, né? Você tá recorrendo ao vídeo, mas você deve ter alguma dúvida sobre esse assunto. Eu tô discutindo com você como se estivesse vendo pela primeira vez, não é? Mas vocês vão encontrar com muita frequência as unidades também em quilômetros por hora. Você sabe que no seu carro, no carro do seu pai, carro da sua mãe, é muito comum a velocidade ser indicada em quilômetros por hora, não é? Como é que nós convertemos uma unidade em outra, professor? Tá aí uma coisa que não é difícil e é muito importante. Nós convertemos, gente, quilômetros por hora para metros por segundo e metros por segundo para quilômetros por hora, fazendo uma multiplicação e fazendo uma divisão por 3,6. Guarda esse número. 3,6 é de extrema importância, tá? De quilômetros por hora para metros por segundo, nós dividimos por 3,6. Anote isso, que você precisa saber. De metros por segundo para quilômetros por hora, nós multiplicamos por 3,6. Tá bom? Bom, exemplos pra você que aparecem com bastante frequência. Gente, a velocidade de 36 quilômetros por hora, a velocidade de 72 quilômetros por hora e a velocidade de 108 quilômetros por hora, são velocidades muito comuns para os carros. Os carros estão se deslocando com velocidades assim. E são valores que são fáceis de você fazer a conta. Por isso que aparecem muito na sua prova. O seu professor cobra muito isso aqui de você. Então, veja só. 36 quilômetros por hora, quanto que vai dar em metros por segundo, professor? Divide por 3,6. 36 por 3,6 é 10, gente. Porque 10 vezes 3,6 é 36. Ah, então é por isso que esse valor aparece bastante. Porque ele é fácil de você fazer a conta. Numa prova, você não pode usar a calculadora. Não é verdade? Então, é comum aparecer em valores que você consiga fazer facilmente. 72 dividido por 3,6 dá 20. Gente, 72 é o dobro de 36. Então, aqui tem que ser o dobro de 10, ou seja, 20. 108 é o triplo de 36. Então, aqui vai dar quanto? Isso mesmo. Aqui vai dar 30, que é o triplo de 10. Tá bom? Então, essa aqui é a aula, a primeira aula de velocidade média. Pessoal, então agora eu vou fazer com você o quê? Eu vou fazer o cálculo pra você nessa situação real de eu andando na estrada com o carro, com a minha esposa segurando o celular e filmando. Eu consegui registrar pra você a minha passagem pelo quilômetro 91 e depois pelo quilômetro 90. Então, delta S vai ser o quê, professor? Final menos inicial. S menos S0. Nesse caso, vai ser o quilômetro 90 menos o inicial, que era 91. Gente, mas peraí. 90 menos 91 não é 1. É menos 1. Menos 1. Gente, menos 1 quilômetro. Mas não tem problema. Eu peguei esse exemplo, nesse formato, pra mostrar pra você que o delta S pode ser positivo, pode ser negativo ou pode ser até mesmo 0. Não estranhe. Então, o delta S de menos 1 quilômetro, eu posso escrever em metros. Vou escrever aqui embaixo. Um delta S em metros vai ser menos mil metros. Em quanto tempo? Você viu ali pelo vídeo que o tempo deu 1 minuto e 13 segundos. Pessoal, 1 minuto e 13 segundos 1 minuto tem 60 segundos, mais 13, 73. 60 mais 13, 73 segundos. Então, a velocidade média vai ficar como, professor? Vai ficar menos mil menos mil dividido por 73. Então, eu vou multiplicar aqui já por 13,6 para que eu já obtenha a resposta em quilômetros por hora, que é a unidade de velocidade mais comum pra nós que estamos no carro, né? Então, vai ficar isso aqui, gente, vai ficar aproximadamente menos 50 quilômetros por hora. Foi a velocidade média que eu tive no carro naquele trecho ali. Então, ó, sai ali da frente pra você copiar. Gente, então, vamos lá, ó. Esse projeto dessa aula começa com a aula 1 da velocidade média. Tem aulas 1, 2 e 3, como eu disse. É a física do zero. Eu vou fazer, vou percorrer todo o conteúdo da física com essa abordagem bastante simplificada pra quem tem bastante dificuldade em física. Esse é um pedido antigo dos meus alunos, então eu vou fazer com bastante cuidado pra vocês. Tá legal? Eu tenho meu trabalho no YouTube, gente, já há muitos anos. Então, no YouTube você tem já tudo bastante completo. Então, se você quiser uma abordagem mais completa com resolução de outros exercícios, você pode pesquisar dentro do próprio YouTube que você encontra no meu canal. Por exemplo, você escreve aí, ó. Boaro velocidade média. Boaro cinemática. Boaro dinâmica. Qualquer outra parte da física. Se você fizer essa pesquisa, você vai encontrar uma série de outros vídeos que eu explico tudo de forma mais aprofundada. Exercício de aprofundamento, exercício pro ENEM e tudo mais. Bom, pessoal, então todo final de vídeo eu vou deixar aqui pros seus links. O link pra você cair nessa playlist de 3 exercícios apenas e link pra você cair nessa playlist maior, que é a playlist da física do zero e outros links de outros vídeos mais. Muito obrigado, com Deus e até mais. Valeu!'
    summarization = summarize_langchain(merged_transcription, 'physical', 'ninth grade of elementary school', 'no')
    return summarization